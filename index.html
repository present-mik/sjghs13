<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>자습 출석 입력</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;max-width:720px;margin:24px auto;padding:0 16px;}
    label{display:block;margin:14px 0 6px;font-weight:600;}
    input,select,button{width:100%;padding:10px 12px;font-size:16px;}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    .status{margin-top:14px;padding:10px 12px;border-radius:8px;display:none;}
    .ok{background:#eef8ee;display:block;}
    .err{background:#fdeeee;display:block;}
    button{margin-top:18px;cursor:pointer;}
    button[disabled]{opacity:.6;cursor:not-allowed;}
  </style>
</head>
<body>
  <h1>자습 출석 입력</h1>

  <form id="form">
    <div class="row">
      <div>
        <label>학번</label>
        <input id="studentId" placeholder="예: 2101" required />
      </div>
      <div>
        <label>이름</label>
        <input id="name" placeholder="이름" required />
      </div>
    </div>

    <label>8교시 자습 장소</label>
    <select id="p8" required>
      <option value="">선택하세요</option>
      <option>교실</option>
      <option>아고라(교무실 옆)</option>
      <option>아고라(3~4반 사이)</option>
      <option>아고라(강의실 1옆)</option>
      <option>시청각실</option>
      <option>한우리관(강당)</option>
      <option>어학실</option>
      <option>지성의 계단</option>
      <option>과학실</option>
      <option>무한상상실</option>
      <option>외출</option>
      <option>외박</option>
      <option>기타</option>
    </select>

    <label>9교시 자습 장소</label>
    <select id="p9" required><!-- 동일 옵션 --></select>

    <label>10교시 자습 장소</label>
    <select id="p10" required><!-- 동일 옵션 --></select>

    <label>11교시 자습 장소</label>
    <select id="p11" required><!-- 동일 옵션 --></select>

    <button id="btn" type="submit">제출</button>
    <div id="status" class="status"></div>
  </form>

  <script>
    const ENDPOINT_URL = "PASTE_YOUR_APPS_SCRIPT_WEBAPP_URL_HERE";

    // p8 옵션을 복제해서 p9~p11에 넣기
    const p8 = document.getElementById("p8");
    ["p9","p10","p11"].forEach(id => {
      const sel = document.getElementById(id);
      sel.innerHTML = p8.innerHTML;
      // value 유지되도록 option 목록 복제
      sel.querySelectorAll("option").forEach((opt,i)=>{
        opt.value = p8.querySelectorAll("option")[i].value || p8.querySelectorAll("option")[i].textContent;
        opt.textContent = p8.querySelectorAll("option")[i].textContent;
      });
      // 첫 option은 value=""
      sel.querySelector("option").value = "";
    });

    const form = document.getElementById("form");
    const btn = document.getElementById("btn");
    const status = document.getElementById("status");

    const norm = s => (s||"").replace(/\s+/g," ").trim();

    function setStatus(msg, ok){
      status.textContent = msg;
      status.className = "status " + (ok ? "ok" : "err");
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const payload = {
        studentId: norm(document.getElementById("studentId").value),
        name: norm(document.getElementById("name").value),
        p8: norm(document.getElementById("p8").value),
        p9: norm(document.getElementById("p9").value),
        p10: norm(document.getElementById("p10").value),
        p11: norm(document.getElementById("p11").value),
      };

      if (!payload.studentId || !payload.name || !payload.p8 || !payload.p9 || !payload.p10 || !payload.p11) {
        setStatus("학번/이름과 8~11교시 장소를 모두 입력하세요.", false);
        return;
      }

      btn.disabled = true;
      try {
        // CORS 단순화를 위해 no-cors 사용(응답은 읽을 수 없음)
        await fetch(https://script.google.com/macros/s/AKfycbxp_NGgSOg7zw7_Mc1R-H32lZiBtFn2wo0Z6nmDfHy1rGJ7gSGQrqI4MhNNVXy3I-DS/exec, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        setStatus("제출 완료(시트 반영까지 몇 초 걸릴 수 있음)", true);
        form.reset();
      } catch (err) {
        setStatus("전송 실패: 네트워크를 확인하세요.", false);
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
